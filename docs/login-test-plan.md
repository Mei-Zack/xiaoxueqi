# 登录功能测试计划

## 测试目标

验证系统的登录功能是否正常工作，确保用户能够成功登录并获取访问令牌。

## 测试环境

- 前端：Vue 3 + TypeScript
- 后端：FastAPI
- 数据库：MySQL/SQLite
- 浏览器：Chrome, Firefox, Edge

## 测试前准备

1. 确保后端服务正在运行
2. 确保前端服务正在运行
3. 确保数据库中存在测试用户
4. 清除浏览器缓存和Cookie

## 测试用例

### 1. 基本登录功能

| 测试ID | TC-LOGIN-001 |
|--------|--------------|
| 测试名称 | 有效凭据登录 |
| 前提条件 | 数据库中存在用户记录 |
| 测试步骤 | 1. 访问登录页面<br>2. 输入有效的邮箱和密码<br>3. 点击"登录"按钮 |
| 预期结果 | 1. 登录成功<br>2. 跳转到仪表盘页面<br>3. 显示用户信息 |

### 2. 无效凭据测试

| 测试ID | TC-LOGIN-002 |
|--------|--------------|
| 测试名称 | 无效邮箱登录 |
| 前提条件 | 无 |
| 测试步骤 | 1. 访问登录页面<br>2. 输入不存在的邮箱和任意密码<br>3. 点击"登录"按钮 |
| 预期结果 | 1. 登录失败<br>2. 显示错误消息"邮箱或密码错误" |

| 测试ID | TC-LOGIN-003 |
|--------|--------------|
| 测试名称 | 无效密码登录 |
| 前提条件 | 数据库中存在用户记录 |
| 测试步骤 | 1. 访问登录页面<br>2. 输入有效邮箱和错误密码<br>3. 点击"登录"按钮 |
| 预期结果 | 1. 登录失败<br>2. 显示错误消息"邮箱或密码错误" |

### 3. 表单验证测试

| 测试ID | TC-LOGIN-004 |
|--------|--------------|
| 测试名称 | 空邮箱验证 |
| 前提条件 | 无 |
| 测试步骤 | 1. 访问登录页面<br>2. 不输入邮箱，只输入密码<br>3. 点击"登录"按钮 |
| 预期结果 | 1. 表单验证失败<br>2. 显示错误消息"请输入邮箱" |

| 测试ID | TC-LOGIN-005 |
|--------|--------------|
| 测试名称 | 空密码验证 |
| 前提条件 | 无 |
| 测试步骤 | 1. 访问登录页面<br>2. 只输入邮箱，不输入密码<br>3. 点击"登录"按钮 |
| 预期结果 | 1. 表单验证失败<br>2. 显示错误消息"请输入密码" |

| 测试ID | TC-LOGIN-006 |
|--------|--------------|
| 测试名称 | 无效邮箱格式验证 |
| 前提条件 | 无 |
| 测试步骤 | 1. 访问登录页面<br>2. 输入无效格式的邮箱（如"test"）和任意密码<br>3. 点击"登录"按钮 |
| 预期结果 | 1. 表单验证失败<br>2. 显示错误消息"请输入正确的邮箱格式" |

### 4. 会话管理测试

| 测试ID | TC-LOGIN-007 |
|--------|--------------|
| 测试名称 | 登录状态保持 |
| 前提条件 | 数据库中存在用户记录 |
| 测试步骤 | 1. 访问登录页面<br>2. 输入有效的邮箱和密码<br>3. 选中"记住我"选项<br>4. 点击"登录"按钮<br>5. 关闭浏览器<br>6. 重新打开浏览器并访问系统 |
| 预期结果 | 1. 无需重新登录<br>2. 直接进入仪表盘页面 |

| 测试ID | TC-LOGIN-008 |
|--------|--------------|
| 测试名称 | 登出功能 |
| 前提条件 | 用户已登录 |
| 测试步骤 | 1. 点击右上角用户头像<br>2. 选择"退出登录"<br>3. 尝试访问需要认证的页面 |
| 预期结果 | 1. 成功登出<br>2. 重定向到登录页面<br>3. 无法访问需要认证的页面 |

### 5. 安全测试

| 测试ID | TC-LOGIN-009 |
|--------|--------------|
| 测试名称 | 密码尝试限制 |
| 前提条件 | 数据库中存在用户记录 |
| 测试步骤 | 1. 访问登录页面<br>2. 使用有效邮箱和错误密码尝试登录多次（>5次） |
| 预期结果 | 1. 登录失败<br>2. 显示账号暂时锁定或需要验证码的提示 |

| 测试ID | TC-LOGIN-010 |
|--------|--------------|
| 测试名称 | 令牌过期测试 |
| 前提条件 | 用户已登录 |
| 测试步骤 | 1. 修改系统时间，使令牌过期<br>2. 尝试访问需要认证的API |
| 预期结果 | 1. API请求返回401错误<br>2. 前端自动重定向到登录页面 |

## 自动化测试脚本

### 后端API测试

使用以下脚本测试后端登录API：

```bash
# 测试登录API
python backend/test_login_api.py

# 验证完整登录流程
python backend/verify_login.py
```

### 前端测试

在浏览器控制台中运行以下脚本测试前端登录功能：

```javascript
// 加载测试脚本
fetch('frontend/src/test-login.js')
  .then(response => response.text())
  .then(script => eval(script));
```

## 测试报告模板

| 测试ID | 测试名称 | 测试日期 | 测试人员 | 测试结果 | 备注 |
|--------|---------|---------|---------|---------|------|
| TC-LOGIN-001 | 有效凭据登录 | YYYY-MM-DD | 测试人员 | 通过/失败 | 备注信息 |
| ... | ... | ... | ... | ... | ... |

## 问题跟踪

如果测试过程中发现问题，请按以下格式记录：

1. 问题ID：BUG-LOGIN-XXX
2. 问题描述：详细描述问题现象
3. 复现步骤：如何复现问题
4. 预期结果：正确的行为应该是什么
5. 实际结果：实际观察到的行为
6. 严重程度：阻断/严重/一般/轻微
7. 优先级：高/中/低
8. 状态：新建/已分配/已修复/已验证/已关闭
9. 附件：相关的截图或日志 